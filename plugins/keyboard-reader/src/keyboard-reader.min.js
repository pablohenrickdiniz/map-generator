(function(a){var b=function(d){var c=this;c.element=d;c.deny=false;c.key_sequence=[];c.allowed_sequences=[];c.last_key_down=null;c.last_key_up=null;c.on_sequence_callbacks=[];c.key_down_callbacks=[];c.key_up_callbacks=[];c.keys=[];c.initialize()};b.prototype.key=function(c){if(b.Keys[c]!==undefined){return b.Keys[c]}return null};b.prototype.on=function(e,d){var c=this;e=e.map(function(f){return b.Keys[f]});c.on_sequence_callbacks.push({sequence:e,callback:d})};b.prototype.keydown=function(d,e){d=b.Keys[d];if(d!==undefined){var c=this;if(c.key_down_callbacks[d]===undefined){c.key_down_callbacks[d]=[]}c.key_down_callbacks[d].push(e)}};b.prototype.keyup=function(d,e){d=b.Keys[d];if(d!==undefined){var c=this;if(c.key_up_callbacks[d]===undefined){c.key_up_callbacks[d]=[]}c.key_up_callbacks[d].push(e)}};b.prototype.sequenceIs=function(g,c,e){var d=this;c=c===undefined?false:c;e=e===undefined?false:e;if(e&&g.length!==d.key_sequence.length){return false}for(var f=0;f<g.length;f++){if(c){if(g[f]!==d.key_sequence[f]){return false}}else{if(d.key_sequence.indexOf(g[f])===-1){return false}}}return true};b.prototype.denyAll=function(){this.deny=true};b.prototype.allowAll=function(){this.deny=false};b.prototype.allow=function(){var c=this;var e=arguments.length;for(var d=0;d<e;d++){var f=arguments[d];if(!(f instanceof Array)){f=[f]}c.allowed_sequences.push(f)}};b.prototype.initialize=function(){var c=this;$(document).ready(function(){console.log("key reader initialize...");$(c.element).attr("tabindex",1);$(c.element).on("click",function(){$(this).focus()});$(c.element).on("keydown",function(h){var k=h.which;c.keys[k]=true;if(c.key_sequence.indexOf(k)===-1){c.key_sequence.push(k)}if(c.deny){var g=c.allowed_sequences.length;var j=false;for(var f=0;f<g;f++){var l=c.allowed_sequences[f];if(c.sequenceIs(l,false,true)){j=true}}if(!j){h.preventDefault()}}c.on_sequence_callbacks.forEach(function(e){if(c.sequenceIs(e.sequence)){e.callback()}});if(c.key_down_callbacks[k]!==undefined){c.key_down_callbacks[k].forEach(function(e){e()})}});$(c.element).on("keyup",function(g){var h=g.which;c.keys[h]=false;var f=c.key_sequence.indexOf(h);if(f!==-1){c.key_sequence.splice(f,1)}if(c.key_up_callbacks[h]!==undefined){c.key_up_callbacks[h].forEach(function(e){e()})}});var d=function(){c.keys.forEach(function(e,f){if(e){if(c.key_up_callbacks[f]!==undefined){c.key_up_callbacks[f].forEach(function(g){g()})}c.keys[f]=false}})};$(c.element).on("focusout",d);$(a).resize(d)})};b.Keys={KEY_GT:190,KEY_LT:188,KEY_DOWN:40,KEY_UP:38,KEY_LEFT:37,KEY_RIGHT:39,KEY_END:35,KEY_BEGIN:36,KEY_BACK_TAB:8,KEY_TAB:9,KEY_SH_TAB:16,KEY_ENTER:13,KEY_ESC:27,KEY_SPACE:32,KEY_DEL:46,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_PLUS:107,KEY_MINUS:109,KEY_PF1:112,KEY_PF2:113,KEY_PF3:114,KEY_PF4:115,KEY_PF5:116,KEY_PF6:117,KEY_PF7:118,KEY_PF8:119,KEY_CTRL:17,KEY_ALT_GR:18,KEY_SBL:221,KEY_SBR:220};b.prototype.isActive=function(d){var c=this;var e=b.Keys[d];if(e!==undefined){return c.keys[e]!==undefined&&c.keys[e]===true}return false};a.KeyReader=b})(window);